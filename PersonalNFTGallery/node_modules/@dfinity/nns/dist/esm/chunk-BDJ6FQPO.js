import{a as z,b as G}from"./chunk-S37GZOMR.js";import{c as V,f as W,h as Q}from"./chunk-EDMSX7GK.js";import{a as p,d as m}from"./chunk-MTPVFXPH.js";import{c as M}from"./chunk-FL7E4DL3.js";import{c as H}from"./chunk-ONAVPXOT.js";var U=({IDL:e})=>{let t=e.Nat64,r=e.Record({start:t,length:e.Nat64}),n=e.Nat64,c=e.Vec(e.Nat8),o=e.Record({e8s:e.Nat64}),a=e.Variant({Burn:e.Record({from:c,amount:o}),Mint:e.Record({to:c,amount:o}),Transfer:e.Record({to:c,fee:o,from:c,amount:o})}),i=e.Record({timestamp_nanos:e.Nat64}),l=e.Record({memo:n,operation:e.Opt(a),created_at_time:i}),d=e.Record({transaction:l,timestamp:i,parent_hash:e.Opt(e.Vec(e.Nat8))}),f=e.Record({blocks:e.Vec(d)}),x=e.Variant({BadFirstBlockIndex:e.Record({requested_index:t,first_valid_index:t}),Other:e.Record({error_message:e.Text,error_code:e.Nat64})}),R=e.Variant({Ok:f,Err:x}),w=e.Func([r],[R],[]),v=e.Record({certificate:e.Opt(e.Vec(e.Nat8)),blocks:e.Vec(d),chain_length:e.Nat64,first_block_index:t,archived_blocks:e.Vec(e.Record({callback:w,start:t,length:e.Nat64}))}),F=e.Record({account:c}),A=e.Record({canister_id:e.Principal}),N=e.Record({archives:e.Vec(A)}),k=e.Vec(e.Nat8),B=e.Record({to:c,fee:o,memo:n,from_subaccount:e.Opt(k),created_at_time:e.Opt(i),amount:o}),O=e.Variant({TxTooOld:e.Record({allowed_window_nanos:e.Nat64}),BadFee:e.Record({expected_fee:o}),TxDuplicate:e.Record({duplicate_of:t}),TxCreatedInFuture:e.Null,InsufficientFunds:e.Record({balance:o})}),S=e.Variant({Ok:t,Err:O}),q=e.Record({}),P=e.Record({transfer_fee:o});return e.Service({_blocks:e.Func([r],[v],[]),account_balance:e.Func([F],[o],[]),archives:e.Func([],[N],[]),decimals:e.Func([],[e.Record({decimals:e.Nat32})],[]),name:e.Func([],[e.Record({name:e.Text})],[]),symbol:e.Func([],[e.Record({symbol:e.Text})],[]),transfer:e.Func([B],[S],[]),transfer_fee:e.Func([q],[P],[])})};var j=({IDL:e})=>{let t=e.Vec(e.Nat8),r=e.Record({account:t}),n=e.Record({e8s:e.Nat64}),c=e.Record({canister_id:e.Principal}),o=e.Record({archives:e.Vec(c)}),a=e.Nat64,i=e.Record({start:a,length:e.Nat64}),l=e.Nat64,d=e.Variant({Burn:e.Record({from:t,amount:n}),Mint:e.Record({to:t,amount:n}),Transfer:e.Record({to:t,fee:n,from:t,amount:n})}),f=e.Record({timestamp_nanos:e.Nat64}),x=e.Record({memo:l,operation:e.Opt(d),created_at_time:f}),R=e.Record({transaction:x,timestamp:f,parent_hash:e.Opt(e.Vec(e.Nat8))}),w=e.Record({blocks:e.Vec(R)}),v=e.Variant({BadFirstBlockIndex:e.Record({requested_index:a,first_valid_index:a}),Other:e.Record({error_message:e.Text,error_code:e.Nat64})}),F=e.Variant({Ok:w,Err:v}),A=e.Func([i],[F],["query"]),N=e.Record({certificate:e.Opt(e.Vec(e.Nat8)),blocks:e.Vec(R),chain_length:e.Nat64,first_block_index:a,archived_blocks:e.Vec(e.Record({callback:A,start:a,length:e.Nat64}))}),k=e.Vec(e.Nat8),B=e.Record({to:t,fee:n,memo:l,from_subaccount:e.Opt(k),created_at_time:e.Opt(f),amount:n}),O=e.Variant({TxTooOld:e.Record({allowed_window_nanos:e.Nat64}),BadFee:e.Record({expected_fee:n}),TxDuplicate:e.Record({duplicate_of:a}),TxCreatedInFuture:e.Null,InsufficientFunds:e.Record({balance:n})}),S=e.Variant({Ok:a,Err:O}),q=e.Record({}),P=e.Record({transfer_fee:n});return e.Service({account_balance:e.Func([r],[n],["query"]),archives:e.Func([],[o],["query"]),decimals:e.Func([],[e.Record({decimals:e.Nat32})],["query"]),name:e.Func([],[e.Record({name:e.Text})],["query"]),query_blocks:e.Func([i],[N],["query"]),symbol:e.Func([],[e.Record({symbol:e.Text})],["query"]),transfer:e.Func([B],[S],[]),transfer_fee:e.Func([q],[P],["query"])})};var s=H(M());var h=H(M());var $=e=>{let t=new Uint8Array(e).buffer,r=new h.Subaccount;return r.setSubAccount(new Uint8Array(t)),r},K=e=>{let t=new h.ICPTs;return t.setE8s(e.toString(10)),t},J=e=>({e8s:e}),X=({to:e,amount:t,memo:r,fee:n,fromSubAccount:c})=>({to:e.toNumbers(),fee:J(n??p),amount:J(t.toE8s()),memo:r??BigInt(0),created_at_time:[],from_subaccount:c===void 0?[]:[c]});var u=class extends Error{},C=class extends u{},_=class extends u{constructor(r){super();this.balance=r}},b=class extends u{constructor(r){super();this.allowed_window_secs=r}},g=class extends u{},T=class extends u{constructor(r){super();this.duplicateOf=r}},E=class extends u{constructor(r){super();this.expectedFee=r}},Y=e=>{if("TxDuplicate"in e)return new T(e.TxDuplicate.duplicate_of);if("InsufficientFunds"in e){let t=m.fromE8s(e.InsufficientFunds.balance.e8s);return new _(t)}return"TxCreatedInFuture"in e?new g:"TxTooOld"in e?new b(Number(e.TxTooOld.allowed_window_nanos)):"BadFee"in e?new E(e.BadFee.expected_fee.e8s):new u(`Unknown error type ${JSON.stringify(e)}`)},Z=e=>{let{message:t}=e;if(t.includes("Reject code: 5")){if(t.match(/Sending from (.*) is not allowed/))return new C;{let r=t.match(/transaction.*duplicate.* in block (\d+)/);if(r&&r.length>1)return new T(BigInt(r[1]))}{let r=t.match(/debit account.*, current balance: (\d*(\.\d*)?)/);if(r&&r.length>1){let n=m.fromString(r[1]);if(n instanceof m)return new _(n)}}if(t.includes("is in future"))return new g;{let r=t.match(/older than (\d+)/);if(r&&r.length>1)return new b(Number.parseInt(r[1]))}}throw e};var y=class{constructor(t,r,n,c,o,a,i=!1){this.agent=t;this.canisterId=r;this.service=n;this.certifiedService=c;this.updateFetcher=o;this.queryFetcher=a;this.hardwareWallet=i}static create(t={}){let r=t.agent??Q(),n=t.canisterId??W,c=t.serviceOverride??V.createActor(j,{agent:r,canisterId:n}),o=t.certifiedServiceOverride??V.createActor(U,{agent:r,canisterId:n});return new y(r,n,c,o,t.updateCallOverride??z,t.queryCallOverride??G,t.hardwareWallet)}accountBalance=async({accountIdentifier:t,certified:r=!0})=>{if(this.hardwareWallet)return this.accountBalanceHardwareWallet({accountIdentifier:t,certified:r});let c=await(r?this.certifiedService:this.service).account_balance({account:t.toNumbers()});return m.fromE8s(c.e8s)};transactionFee=async()=>{let{transfer_fee:{e8s:t}}=await this.service.transfer_fee({});return t};transfer=async t=>{if(this.hardwareWallet)return this.transferHardwareWallet(t);t.fee===void 0&&(t.fee=this.hardwareWallet?p:await this.transactionFee());let r=X(t),n=await this.certifiedService.transfer(r);if("Err"in n)throw Y(n.Err);return n.Ok};accountBalanceHardwareWallet=async({accountIdentifier:t,certified:r=!0})=>{let n=r?this.updateFetcher:this.queryFetcher,c=new s.AccountBalanceRequest;c.setAccount(t.toProto());let o=await n({agent:this.agent,canisterId:this.canisterId,methodName:"account_balance_pb",arg:c.serializeBinary()});return m.fromE8s(BigInt(s.ICPTs.deserializeBinary(new Uint8Array(o)).getE8s()))};transferHardwareWallet=async({to:t,amount:r,memo:n,fee:c,fromSubAccount:o})=>{let a=new s.SendRequest;a.setTo(t.toProto());let i=new s.Payment;i.setReceiverGets(r.toProto()),a.setPayment(i),a.setMaxFee(K(c??p));let l=new s.Memo;l.setMemo((n??BigInt(0)).toString()),a.setMemo(l),o!==void 0&&a.setFromSubaccount($(o));try{let d=await this.updateFetcher({agent:this.agent,canisterId:this.canisterId,methodName:"send_pb",arg:a.serializeBinary()});return BigInt(s.BlockHeight.deserializeBinary(d).getHeight())}catch(d){throw d instanceof Error?Z(d):d}}};export{u as a,C as b,_ as c,b as d,g as e,T as f,E as g,Y as h,Z as i,y as j};
//# sourceMappingURL=chunk-BDJ6FQPO.js.map
